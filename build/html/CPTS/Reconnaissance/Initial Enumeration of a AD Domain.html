

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Initial Enumeration of a AD Domain &mdash; CelestialTech-Notes R1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f9ffe49" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=3b1ff954"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/dark_mode_js/default_dark.js?v=fd565c74"></script>
      <script src="../../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="External Recon and Enumeration Principles" href="External%20Recon%20and%20Enumeration%20Principles.html" />
    <link rel="prev" title="fingerprinting" href="fingerprinting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CelestialTech-Notes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Offensive Methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OFSEC/recon/Active%20Scanning.html">Active Scanning (T5195)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OFSEC/evasion/Evading%20EDR%20and%20AntiVirus.html">Evading EDR and AntiVirus</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reconnaissance</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Penetration%20Testing%20Overview.html">Penetration Testing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Network%20Enumeration%20with%20nmap.html">Network Enumeration with nmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="Footprinting.html">Footprinting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Infrastructure%20Enumeration.html">Infrastructure Based Enumeration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Host%20Enumeration.html">Host Based Enumeration</a></li>
<li class="toctree-l1"><a class="reference internal" href="fingerprinting.html">fingerprinting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Initial Enumeration of a AD Domain</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mapping-out-the-network">Mapping out the network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#identifying-users">Identifying users</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kerberute">Kerberute</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#about-ad-privileges">About AD privileges</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ways-to-get-system-level-access">Ways to get System level access</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-is-a-system-account-used">How is a System account used</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="External%20Recon%20and%20Enumeration%20Principles.html">External Recon and Enumeration Principles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Initial Access</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/File%20Inclusion.html">File Inclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/SSH%20Forwarding.html">SSH Forwarding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/Dynamic%20Port%20Forwarding%20with%20SSH%20and%20SOCKS%20Tunneling.html">Dynamic Port Forwarding with SSH and SOCKS Tunneling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/Remote-Reverse%20Port%20Forwarding%20with%20SSH.html">Remote-Reverse Port Forwarding with SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/Meterpreter%20Tunneling%20and%20Port%20Forwarding.html">Meterpreter Tunneling and Port Forwarding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/Socat%20Redirection%20with%20a%20Reverse%20Shell.html">Socat Redirection with a Reverse Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/Socat%20Redirection%20with%20a%20Bind%20Shell.html">Socat Redirection with a Bind Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/SSH%20for%20Windows%3A%20plink.exe.html">SSH for Windows: plink.exe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/SSH%20Pivoting%20with%20Sshuttle.html">SSH Pivoting with Sshuttle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/Web%20Server%20Pivoting%20with%20Rpivot.html">Web Server Pivoting with Rpivot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/Port%20Forwarding%20with%20Windows%20Netsh.html">Port Forwarding with Windows Netsh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/DNS%20Tunneling%20with%20Dnscat2.html">DNS Tunneling with Dnscat2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/SOCKS5%20Tunneling%20with%20Chisel.html">SOCKS5 Tunneling with Chisel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/ICMP%20Tunneling%20with%20SOCKS.html">ICMP Tunneling with SOCKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/RDP%20and%20SOCKS%20Tunneling%20with%20SocksOverRDP.html">RDP and SOCKS Tunneling with SocksOverRDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Initial%20Access/LLMNR%20NBT-NS%20Poisoning%20from%20Linux.html">LLMNR/NBT-NS Poisoning - from Linux</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Active%20Directory.html">Active Directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Bash.html">console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/bettercap.html">bettercap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Bitlocker.html">Bitlocker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/bloodhound.py.html">bloodhound.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Certificates.html">Certificates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/cewl.html">cewl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/chisel.html">chisel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Compliance%20Standards.html">Compliance Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Compliance%20Standards.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/crawling.html">crawling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/crowbar.html">crowbar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/crunch.html">crunch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/cupp.html">cupp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/CVSS.html">CVSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/DKIM.html">DKIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/DMARC.html">DMARC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/DNS.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/dnsenum.html">dnsenum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/dnsrecon.html">dnsrecon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/dnsx.html">dnsx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ettercap.html">ettercap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/evil-winrm.html">evil-winrm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/fail2ban.html">fail2ban</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ffuf.html">ffuf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/fierce.html">fierce</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/File%20Encryption%20on%20Linux.html">File Encryption on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/File%20Encryption%20Windows.html">File Encryption on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/finalRecon.html">finalRecon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Firefox%20Decrypt.html">Firefox Decrypt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/FTP.html">FTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/git.html">git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/gobuster.html">gobuster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/hashcat.html">hashcat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/hydra.html">hydra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/impacket.html">imapacket</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/invoke-TheHash.html">Invoke-TheHash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/kerbrute.html">kerbrute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/netstat.html">netstat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/netstat.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/subfinder.html">subfinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smtp-user-enum.html">smtp-user-enum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/winrm.html">winrm</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CelestialTech-Notes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Initial Enumeration of a AD Domain</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/CPTS/Reconnaissance/Initial Enumeration of a AD Domain.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="initial-enumeration-of-a-ad-domain">
<h1>Initial Enumeration of a AD Domain<a class="headerlink" href="#initial-enumeration-of-a-ad-domain" title="Link to this heading"></a></h1>
<p>Options to allow an initial foothold in a network to begin enumeration</p>
<ol class="arabic simple">
<li><p>A Virtual machine with VPN provided</p></li>
<li><p>A physical device plugged into a ethernet port with VPN</p></li>
<li><p>Physical presence in their office</p></li>
<li><p>A Linux VM in the cloud with access to the internal network</p></li>
<li><p>VPN access into the network</p></li>
<li><p>From a corporate laptop connected by VPN</p></li>
<li><p>On a managed workstation</p></li>
</ol>
<section id="mapping-out-the-network">
<h2>Mapping out the network<a class="headerlink" href="#mapping-out-the-network" title="Link to this heading"></a></h2>
<p>During the enumeration stage, we have access to tools like:</p>
<ol class="arabic simple">
<li><p>fping</p></li>
<li><p>responder</p></li>
<li><p>nmap</p></li>
<li><p>tcpdump</p></li>
</ol>
<p>To start discovering hosts on various networks.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">fping -asgq 172.16.5.0/23</span>
</pre></div>
</div>
<p>If we save the host list to a file, we can further enumerate the host for services and OS detection</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo nmap -v -A -iL hosts.txt -oN output.txt</span>
</pre></div>
</div>
</section>
<section id="identifying-users">
<h2>Identifying users<a class="headerlink" href="#identifying-users" title="Link to this heading"></a></h2>
<p>When no initial user is provided, there are techniques to identify users to work with:</p>
<section id="kerberute">
<h3>Kerberute<a class="headerlink" href="#kerberute" title="Link to this heading"></a></h3>
<p>See installation and usage :ref: <cite>../../tags/kerberute</cite></p>
<p>From Kerbrute we now have a list of usernames we can use in a password spray attack.</p>
</section>
</section>
<section id="about-ad-privileges">
<h2>About AD privileges<a class="headerlink" href="#about-ad-privileges" title="Link to this heading"></a></h2>
<p>The <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/services/localsystem-account">local system account</a> <cite>NT AuthoritySYSTEM</cite> has the highest access
and is used to run most services. If this machine is part of a domain, it can be used to enumerate other machines in the domain.</p>
</section>
<section id="ways-to-get-system-level-access">
<h2>Ways to get System level access<a class="headerlink" href="#ways-to-get-system-level-access" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Remote Windows exploits such as MS08-067, EternalBlue, or BlueKeep.</p></li>
<li><p>Abusing a service running in the context of the SYSTEM account, or abusing the service account SeImpersonate privileges using Juicy Potato. This type of attack is possible on older Windows OS’ but not always possible with Windows Server 2019.</p></li>
<li><p>Local privilege escalation flaws in Windows operating systems such as the Windows 10 Task Scheduler 0-day.</p></li>
<li><p>Gaining admin access on a domain-joined host with a local account and using Psexec to launch a SYSTEM cmd window</p></li>
</ol>
</section>
<section id="how-is-a-system-account-used">
<h2>How is a System account used<a class="headerlink" href="#how-is-a-system-account-used" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Enumerate the domain using built-in tools or offensive tools such as BloodHound and PowerView.</p></li>
<li><p>Perform Kerberoasting / ASREPRoasting attacks within the same domain.</p></li>
<li><p>Run tools such as Inveigh to gather Net-NTLMv2 hashes or perform SMB relay attacks.</p></li>
<li><p>Perform token impersonation to hijack a privileged domain user account.</p></li>
<li><p>Carry out ACL attacks.</p></li>
</ol>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://academy.hackthebox.com/module/143/section/1265s">https://academy.hackthebox.com/module/143/section/1265s</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fingerprinting.html" class="btn btn-neutral float-left" title="fingerprinting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="External%20Recon%20and%20Enumeration%20Principles.html" class="btn btn-neutral float-right" title="External Recon and Enumeration Principles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, James Jamieson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>